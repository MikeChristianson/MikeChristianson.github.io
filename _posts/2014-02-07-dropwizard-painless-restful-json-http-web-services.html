---
layout: post
title: 'Dropwizard: painless RESTful JSON HTTP web services'
categories: []
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '2'
  _wpcom_is_markdown: '1'
  _wpas_done_all: '1'
---
<a href="http://dropwizard.codahale.com/"><img src="http://dropwizard.codahale.com/_static/xdropwizard-hat.png.pagespeed.ic.t8SjDATVsD.png" width="150" height="246" class="alignright" /></a>Java developers looking for a quick, painless way of creating production-ready RESTful JSON HTTP web services should consider the <a href="http://dropwizard.codahale.com/">Dropwizard</a> framework.

Dropwizard brings together well-regarded libraries that compliment each other so you can get to what's important: writing and delivering working code.

For those interested in details on the libraries used, please refer to the <a href="http://dropwizard.codahale.com/getting-started/#overview">Dropwizard overview</a>. Fortunately, Dropwizard doesn't make you deal with all of its individual components. You'll be able to keep your focus on your work at hand.

If you've got some time, stick around and let's make something with Dropwizard.<!--more--> All code for this tutorial is available at <a href="https://codeaweso.me/_/dwtutcode">github.com/MikeChristianson/dropwizard-tutorial</a>.

<h2>How do you get started with Dropwizard?</h2>

A single Maven, Gradle, or Ivy dependency will get you all the components necessary for making Dropwizard-powered web services.

<pre lang="xml">
<dependency>
    <groupId>com.yammer.dropwizard</groupId>
    <artifactId>dropwizard-core</artifactId>
    <version>0.6.2</version>
</dependency>
</pre>

<em>Note</em>: Please refer to <a href="http://dropwizard.codahale.com/getting-started/">Dropwizard's excellent documentation</a> if you encounter anything you think isn't explained sufficiently in this short posting.

<h2>What shall we make?</h2>

Let's make a web service that returns the current date and time for a given timezone. We'll use a configurable default timezone if a client decides not to specify one.

<h2>Configuration</h2>

Our super-simple <code>time-service.yml</code> configuration file will look like this.

<pre lang="json">defaultTimezone: UTC</pre>

Behind the scenes, Dropwizard will load, parse, validate, and turn that configuration into an object. All we need to do is specify it as a class.

<pre lang="java">public class TimezoneConfiguration extends Configuration {
    @NotEmpty
    @JsonProperty
    private String defaultTimezone;

    public String getDefaultTimezone() { return defaultTimezone; }
}</pre>

<h2>Service Output</h2>

Let's say we want the output of our web service to look like this.

<pre lang="json">{ "time": "2014-02-04 13:45:02" }</pre>

The corresponding class is straightforward.

<pre lang="java">public class Time {
    private final String time;

    public Time(String time) {
        this.time = time;
    }

    public String getTime() { return time; }
}</pre>

<h2>Resource</h2>

Next, we decide we want the URL path for our web service to be <code>/time</code>. And we need to specify the resource will return JSON. Putting those together gives us this.

<pre lang="java">@Path("/time")
@Produces(MediaType.APPLICATION_JSON)
public class TimeResource {
}</pre>

The only RESTful action that makes sense right now for our demo web service is <code>GET</code>, so let's make a method for that. When consuming our web service, the client can provide a timezone as a query string parameter.

<pre lang="java">@GET
public Time getTime(@QueryParam("timezone") String timezone) {
}</pre>

That leaves us with three more things to do:

<ol>
<li>handle a given timezone from the client</li>
<li>substitute a default timezone if none is given</li>
<li>format the current date and time with the timezone</li>
</ol>

<pre lang="java">@Path("/time")
@Produces(MediaType.APPLICATION_JSON)
public class TimeResource {
    private final String defaultTimezone;

    public TimeResource(String defaultTimezone) {
        this.defaultTimezone = defaultTimezone;
    }

    @GET
    public Time getTime(@QueryParam("timezone") Optional<String> timezone) {
        DateFormat formatter = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        TimeZone timeZone = TimeZone.getTimeZone(timezone.or(defaultTimezone));
        formatter.setTimeZone(timeZone);
        String formatted = formatter.format(new Date());
        return new Time(formatted);
    }
}</pre>

<h2>Service</h2>

Now, let's bring together all the pieces of our web service in our entry-point class we'll call <code>TimeService</code>. Here we'll use our <code>TimezoneConfiguration</code> to pass the default timezone to <code>TimeResource</code>.

<pre lang="java">public class TimeService extends Service<TimezoneConfiguration> {
    public static void main(String[] args) throws Exception {
        new TimeService().run(args);
    }

    @Override
    public void run(TimezoneConfiguration config, Environment environment) {
        String defaultTimezone = config.getDefaultTimezone();
        TimeResource timeResource = new TimeResource(defaultTimezone);
        environment.addResource(timeResource);
    }

    @Override
    public void initialize(Bootstrap<TimezoneConfiguration> timezoneConfigurationBootstrap) {
    }
}</pre>

<h2>Pencils Down</h2>

That's it! We've just written a Dropwizard-based web service without mind-numbing boilerplate or mounds of obtuse XML configuration.

<h2>Running</h2>

Running your web service is as simple as executing a command-line Java application -- no need to worry about <code>.war</code> files or servlet containers.

<pre lang="bash">java -cp libraries/* name.christianson.mike.TimeService server time-service.yml</pre>

Now, point your web browser or <code>curl</code> at <code>http://localhost:8080/time?timezone=MST</code> and have fun!

All code for this tutorial is available at <a href="https://codeaweso.me/_/dwtutcode">github.com/MikeChristianson/dropwizard-tutorial</a>.
